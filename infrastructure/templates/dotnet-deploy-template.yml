parameters:
  - name: appName
    type: string
  - name: projectPath
    type: string

steps:
  # Install .NET SDK
  - task: UseDotNet@2
    displayName: 'Use .NET 8 SDK'
    inputs:
      packageType: 'sdk'
      version: '8.x'

  # Restore packages
  - task: DotNetCoreCLI@2
    displayName: 'Restore Packages'
    inputs:
      command: 'restore'
      projects: ${{ parameters.projectPath }}

  # Build project
  - task: DotNetCoreCLI@2
    displayName: 'Build Project'
    inputs:
      command: 'build'
      projects: ${{ parameters.projectPath }}
      arguments: '--configuration $(buildConfiguration)'

  # Publish project
  - task: DotNetCoreCLI@2
    displayName: 'Publish Project'
    inputs:
      command: 'publish'
      publishWebProjects: false
      projects: ${{ parameters.projectPath }}
      arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'
      zipAfterPublish: true

  # Deploy to Azure App Service
  - task: AzureWebApp@1
    displayName: 'Deploy to Azure WebApp - ${{ parameters.appName }}'
    inputs:
      azureSubscription: 'AzureServiceConnection'   # must match your service connection name in DevOps
      appType: 'webApp'
      appName: ${{ parameters.appName }}
      package: '$(Build.ArtifactStagingDirectory)/**/*.zip'
